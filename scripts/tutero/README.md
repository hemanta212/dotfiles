# Tutero Scripts

This README is generated by `generate-readme.sh`. Run it after changing any script documentation.

## Overview
- [`autist`](./autist) — Wraps codex exec sessions with background logging and resume help.
- [`auto-run`](./auto-run) — Starts ./run, tails its log, and waits for the RUNNING signal before exiting.
- [`big-brain`](./big-brain) — Runs the opencode big-brain agent and extracts only its user-facing response.
- [`chrome-flutter-extension.sh`](./chrome-flutter-extension.sh) — Launches Thorium/Chromium with a dedicated profile while filtering Flutter flags.
- [`db-oracle`](./db-oracle) — Single-entry point to run codex against the resources/learning/teaching oracle with logs.
- [`db-oracle-oc`](./db-oracle-oc) — Pipe-only wrapper that feeds stdin prompts into the db-oracle opencode agent.
- [`gcp-image-push.sh`](./gcp-image-push.sh) — Interactive helper to version, build, and push Docker images into the mathgaps Artifact Registry.
- [`gh-delivery-watch/gh-deliver`](./gh-delivery-watch/gh-deliver) — CLI to configure and control the gh-deliver monitoring daemon for GitHub Delivery workflows.
- [`gh-delivery-watch/gh-deliver-daemon`](./gh-delivery-watch/gh-deliver-daemon) — Background worker that polls GitHub Delivery workflows and posts alerts for failures.
- [`gh-delivery-watch/install.sh`](./gh-delivery-watch/install.sh) — Installs gh-deliver CLI/daemon into ~/.local/bin and seeds the cache directory.
- [`local-librarian`](./local-librarian) — Runs the local-librarian agent on piped prompts while keeping structured logs.
- [`monitor-cpu.sh`](./monitor-cpu.sh) — Watches resources-graphql pods and alerts when CPU usage exceeds 60% of the limit.
- [`neo4j-usage-export.go`](./neo4j-usage-export.go) — Exports Neo4j usage/context artifacts by scanning Go sources and pulling schema dumps.
- [`preview-link/preview-tunnel`](./preview-link/preview-tunnel) — Dispatches preview tunnel control commands (start/stop/status/logs/restart).
- [`preview-link/preview-tunnel-logs`](./preview-link/preview-tunnel-logs) — Streams or prints the preview tunnel log file with optional follow mode.
- [`preview-link/preview-tunnel-restart`](./preview-link/preview-tunnel-restart) — Restarts the preview tunnel by stopping and starting it again.
- [`preview-link/preview-tunnel-start`](./preview-link/preview-tunnel-start) — Starts the preview tunnel via nohup and validates the PID file.
- [`preview-link/preview-tunnel-status`](./preview-link/preview-tunnel-status) — Prints tunnel health, uptime, and recent logs while warning if it is not running.
- [`preview-link/preview-tunnel-stop`](./preview-link/preview-tunnel-stop) — Stops the preview tunnel process and its SSH children.
- [`preview-link/preview-tunnel.sh`](./preview-link/preview-tunnel.sh) — Keeps an ssh reverse tunnel from vps.osac.org.np:6999 to localhost:3003 alive.
- [`project-oracle`](./project-oracle) — Simpler codex wrapper tuned to the current project with low reasoning.
- [`pub-override`](./pub-override) — Automatically finds a Flutter package and writes it into pubspec_overrides.yaml.
- [`restore-db.sh`](./restore-db.sh) — Interactive Neo4j backup restore utility for dev and prod buckets.
- [`router-forward/install-service.sh`](./router-forward/install-service.sh) — Installs the router-forward LaunchAgent with the correct Home path.
- [`router-forward/main.go`](./router-forward/main.go) — Go port forwarder that matches a pod prefix and keeps kubectl port-forward alive.
- [`router-forward/uninstall-service.sh`](./router-forward/uninstall-service.sh) — Uninstalls the router-forward LaunchAgent by unloading and removing its plist.
- [`run`](./run) — Manages building and launching the resources service with caching, telemetry, and log plumbing.
- [`run_telec.sh`](./run_telec.sh) — Runs the telec function every five seconds to keep the telemetry agent warm.
- [`session-hunter`](./session-hunter) — Runs the session-hunter agent and extracts the clean output from noisy logs.
- [`tele-ips.sh`](./tele-ips.sh) — Adds Telegram IP ranges via the utun4 WireGuard interface.
- [`tele-urls`](./tele-urls) — Lists all telepresence-forwarded .cluster.local service URLs.
- [`trigger-neo4j-backup.sh`](./trigger-neo4j-backup.sh) — Triggers and monitors Neo4j backup cronjobs across prod contexts.
- [`wclean`](./wclean) — Repo-agnostic worktree cleanup tool that optionally removes local/remote branches.
- [`wspin`](./wspin) — Parses git/PR commands, optionally generates AI names, and spins up a worktree/PR.

## Scripts
### [`autist`](./autist)

Executes Codex in the invoking directory while redirecting output into timestamped ~/.cache/scripts/autist logs.  
Spawns a background watcher that polls the log for the session ID so it can be replayed.  
Reads prompts from args or stdin and prefixes a strict oracle instruction before running the agent.  
Prints follow-up command templates and shows where the complete log lives on success or failure.  

### [`auto-run`](./auto-run)

Validates that ./run exists next to the caller and is executable before launching it with nohup.  
Streams the log via tail -f so you can see startup events while the script waits for the service to stabilize.  
Times out after RUN_AUTO_TIMEOUT (default 60s) if the RUNNING indicator never appears and dumps the tail.  
Prints the log path on success so you can follow it yourself and stops the tail feed cleanly as it exits.  

### [`big-brain`](./big-brain)

Redirects the agent output to a temp file and then strings the binary output into a cached log under ~/.cache/scripts/big-brain.  
Looks for <output> tags and prints just the clean body when possible, removing tooling noise.  
Falls back to Claude Haiku extraction with retries if tags are missing, filtering out plugin/status chatter.  
Echoes detailed failure diagnostics including the raw log tail when the response cannot be extracted.  

### [`chrome-flutter-extension.sh`](./chrome-flutter-extension.sh)

Kills any existing Thorium instance, resolves the desired profile path, and starts the browser backgrounded.  
Drops Flutter-specified params like --disable-extensions, --bwsi, and user-data-dir so the chosen profile stays intact.  
Traps termination signals to cleanly kill the spawned browser once Flutter stops.  
Waits in the foreground so Flutter tooling can detect when the browser exists and the test run completes.  

### [`db-oracle`](./db-oracle)

Requires the -db flag (resources, learning, or teaching) and optional extra dirs to build the prompt.  
Runs codex exec inside ~/Coding/metarepo with low reasoning effort and optional verbose mode.  
Writes logs to ~/.cache/scripts/oracle-logs plus /tmp output files so the result can be re-read.  
Prints any session ID it sees so you can resume with --continue and surfaces the log path on failure.  

### [`db-oracle-oc`](./db-oracle-oc)

Requires the -db flag, ensures prompts are provided via stdin, and optionally records additional project directories.  
Builds a final prompt string that includes referenced directories and the piped query before calling opencode.  
Runs from ~/Coding/metarepo, captures stderr into a temp log, and flushes a cleaned log into ~/.cache/scripts/oracle-logs.  
Prints the final log when verbose and otherwise echoes the agent output, making it easy to inspect failures.  

### [`gcp-image-push.sh`](./gcp-image-push.sh)

Validates docker/gcloud/fzf, switches gcloud to the mathgaps project, and prompts for image name/tag selection.  
Lists recent tags with parallel description lookups, suggests semantic increments, and records the chosen tag.  
Builds the container with docker buildx for linux/amd64, pushes it to the regional Artifact Registry, and prints progress.  
Fetches existing tag descriptions via the Registry API and logs key info so the next push is easier to decide.  

### [`gh-delivery-watch/gh-deliver`](./gh-delivery-watch/gh-deliver)

Bootstraps ~/.cache/scripts/gh-deliver-monitor state/config/repos/log files and keeps ANSI CLI help ready.  
Supports add/remove/list commands with repo/workflow filters plus enable/disable and reset helpers.  
Starts/stops/restarts the daemon, fetches statuses/logs, and lets you tail output with -f.  
Exposes config show/set for interval/window/notifications and reloads the daemon whenever repos or config change.  

### [`gh-delivery-watch/gh-deliver-daemon`](./gh-delivery-watch/gh-deliver-daemon)

Loads repo/config/state JSON, enumerates enabled repos, and queries gh run list for recent workflows.  
Records alerted run IDs to avoid duplicated alerts, updating repo metadata after each check.  
Sends optional audio/desktop notifications plus colored logs when new failures appear.  
Supports a once-mode, respects configurable intervals/check limits, and retries with backoff when needed.  

### [`gh-delivery-watch/install.sh`](./gh-delivery-watch/install.sh)

Ensures ~/.local/bin exists, warns if it is missing from PATH, and makes every script executable.  
Symlinks gh-deliver into ~/.local/bin so the CLI is globally available.  
Creates ~/.cache/scripts/gh-deliver-monitor and bootstraps repos/config/state JSON defaults.  
Prints quick-start steps covering add/start/status/log commands plus how to get help.  

### [`local-librarian`](./local-librarian)

Reads stdin prompts, combines them with the invoking directory context, and runs opencode with the local-librarian agent.  
Writes cleaned output via strings into ~/.cache/scripts/local-librarian-logs and then prints the answer.  
Supports a -v verbose flag that leaves opencode stderr unfiltered for debugging.  
Always executes from $HOME to give the agent access to every repository and respects the trap semantics.  

### [`monitor-cpu.sh`](./monitor-cpu.sh)

Uses kubectl top pods for the learning namespace, calculates percent of the 300m CPU limit, and logs color-coded statuses.  
Keeps a list of alerted pods to avoid spamming notifications and clears entries when values drop below threshold.  
Sends macOS notifications via osascript and prints warnings when CPU approaches higher bounds.  
Loops every 15 seconds, verifies namespace access before starting, and traps INT/TERM for a graceful shutdown.  

### [`neo4j-usage-export.go`](./neo4j-usage-export.go)

Parses Go files for Neo4j/neogo operations while keeping brace depth and string literal state under control.  
Aggregates edge/entity definition files plus API subfolders into organized exports under the configured directory.  
Queries Neo4j schema via kubectl from running pods and writes JSON schema files per namespace.  
Limits block lengths, skips ignored directories, and produces data tailored for AI tooling needs.  

### [`preview-link/preview-tunnel`](./preview-link/preview-tunnel)

Resolves the script directory so subcommands execute from the correct location.  
Routes start/stop/restart/status/log/logs commands to their respective helper scripts.  
Shows a helpful usage message when no command or an unknown command is supplied.  
Passes additional arguments like -f through to the logs helper for tailing.  

### [`preview-link/preview-tunnel-logs`](./preview-link/preview-tunnel-logs)

Verifies ~/logs/preview-tunnel.log exists before attempting to read it.  
Supports -f/--follow to tail the log; otherwise dumps the last 50 lines.  
Adds colorized headings and a tip about using logs -f for real-time observation.  
Fails cleanly with warnings when the log file is missing.  

### [`preview-link/preview-tunnel-restart`](./preview-link/preview-tunnel-restart)

Displays a restart banner, calls the stop helper, waits briefly, and then starts the tunnel.  
Relies on the same PID/log infrastructure as the other helpers so state stays consistent.  
Useful after manual config or network tweaks that require a fresh tunnel.  
Exit status reflects whether both the stop and start succeeded.  

### [`preview-link/preview-tunnel-start`](./preview-link/preview-tunnel-start)

Cleans stale PID files, prepares directories, and launches preview-tunnel.sh in the background.  
Waits up to 10 seconds for the PID file to appear and fails if the process dies immediately.  
Prints management hints (status/stop/logs) plus the preview URL once booted.  
Leaves the PID in ~/.local/run/preview-tunnel.pid and logs under ~/logs/preview-tunnel.log.  

### [`preview-link/preview-tunnel-status`](./preview-link/preview-tunnel-status)

Checks the PID file, cleans stale state, and reports running status or failure accordingly.  
Displays PID, uptime, remote/local endpoints, and the preview URL for quick orientation.  
Adds SSH connection detection plus a tail of recent log entries for fast triage.  
Returns a non-zero exit code when the tunnel is absent so automation can detect failure.  

### [`preview-link/preview-tunnel-stop`](./preview-link/preview-tunnel-stop)

Reads the PID from ~/.local/run/preview-tunnel.pid and guards against stale entries.  
Kills the main PID and its children, retries until the process exits, and forces a kill if needed.  
Removes the PID file afterward so future starts are clean.  
Reports success or failure with colorized feedback.  

### [`preview-link/preview-tunnel.sh`](./preview-link/preview-tunnel.sh)

Records its PID and logs before entering a reconnection loop.  
Runs ssh -N -T -R with keepalives while streaming stdout/stderr into the tunnel log.  
Retries after disconnections with a configurable delay so the tunnel self-heals.  
Handles SIGINT/SIGTERM via cleanup so the PID file is removed when the daemon exits.  

### [`project-oracle`](./project-oracle)

Runs codex exec from the invoking folder with model_reasoning_effort defaulting to low.  
Accepts --session to resume existing conversations and -r to raise reasoning effort.  
Captures output to ~/.cache/scripts/project-oracle logs and echoes follow-up commands when done.  
Prints log paths and cleans up temporary output files after each run.  

### [`pub-override`](./pub-override)

Searches ~/Coding/metarepo for directories matching the provided path components.  
Creates pubspec_overrides.yaml if missing and avoids duplicate entries.  
Derives the package name from the package pubspec.yaml before writing the override.  
Records the override and points you back to the file for future edits.  

### [`restore-db.sh`](./restore-db.sh)

Lists available backups from gs://neo4j-backups-{dev,prod}, optionally letting fzf pick one.  
Switches kubectl context to the configured prod context and caches selected URLs in /tmp.  
Downloads the backup, runs the restore job, and streams progress with colored headings and logs.  
Keeps recent choices cached, warns when dependencies are missing, and exits cleanly on errors.  

### [`router-forward/install-service.sh`](./router-forward/install-service.sh)

Copies the plist into ~/Library/LaunchAgents, replacing /Users/mac with the current $HOME.  
Creates ~/logs, makes sure the service is executable, and reloads it via launchctl.  
Prints management commands (start/stop/restart/status/log) after loading.  
Lists the uninstall steps so removing the LaunchAgent is straightforward.  

### [`router-forward/main.go`](./router-forward/main.go)

Parses flags for pod prefix/context/ports/namespace and runs until interrupted.  
Discovers the target pod via kubectl, preferring the provided namespace or auto-detecting one.  
Starts kubectl port-forward, logs the command, and retries on disconnects with a delay.  
Handles interrupts via context cancellation so the subprocess cleans up before exit.  

### [`router-forward/uninstall-service.sh`](./router-forward/uninstall-service.sh)

Targets ~/Library/LaunchAgents/com.user.router-forward.plist and unloads it via launchctl.  
Deletes the plist file afterward so the service cannot restart.  
Warns when the plist is already missing so you know nothing changed.  
Is safe to rerun because it ignores already-uninstalled states.  

### [`run`](./run)

Prepares config defaults, port constants, and lock-backed cache files before launching the Go server.  
Parses flags for telemetry (-otel), estimate-only modes, config overrides, and additional go args.  
Creates a FIFO log pipe, tails it for structured output, and ensures graphql/grpc ports stay free.  
Tracks interrupts, records boot estimates, and checks telepresence router reachability before starting.  

### [`run_telec.sh`](./run_telec.sh)

Loops indefinitely, invoking zsh -ic telec every five seconds with timestamps for traceability.  
Prints headers before each run so you can see when it last executed.  
Relies on the telec function defined in ~/.config/zsh/zsh/functionrc.  
Stays alive until interrupted so other automation keeps the remote session warm.  

### [`session-hunter`](./session-hunter)

Invokes opencode session-hunter from the current directory, reading prompts from stdin or args.  
Stores raw output under ~/.cache/scripts/session-hunter and strings it to remove binaries.  
Looks for <output> tags and falls back to Claude Haiku extraction with retries when needed.  
Prints follow-up instructions and log locations when extraction succeeds or fails.  

### [`tele-ips.sh`](./tele-ips.sh)

Verifies the utun4 interface exists before touching routes.  
Adds static routes for known Telegram CIDRs through utun4.  
Sleeps indefinitely afterward so the interface stays bound until you stop it.  
Exits early if the interface is down so you can rerun the script later.  

### [`tele-urls`](./tele-urls)

Queries kubectl get services across namespaces and prints <name>.<namespace>.svc.cluster.local hosts.  
Sorts the output for readability and hides stderr to keep the list clean.  
Adds a brief header so the context is obvious when the script runs.  
Is a quick way to check what is currently routed via telepresence.  

### [`trigger-neo4j-backup.sh`](./trigger-neo4j-backup.sh)

Creates manual jobs derived from the cronjob on both prod and prod-us contexts.  
Finds the backup pod, streams status, and polls until the job completes or fails.  
Shows container statuses and relevant logs when a job finishes.  
Uses colored helpers to highlight info, success, and error states for each context.  

### [`wclean`](./wclean)

Accepts a folder name, validates the git repo, and removes the worktree safely.  
Detects the branch associated with the worktree and prompts before deleting it unless --force is used.  
Supports deleting remote branches when --remote or --force is supplied.  
Prints a summary of the cleanup and handles missing directories gracefully.  

### [`wspin`](./wspin)

Scans the provided command for branch names or PR titles and invokes the branch-namer agent when needed.  
Generates formatted branch/folder names, updates the command to include checkout, and prints diagnostics.  
Creates the worktree (using remote branch when available), copies dev files, and enters the new folder.  
Pushes new branches, prompts to create GH PRs when missing, and drops you into a shell inside the worktree.
